{% extends 'base.html' %}

{% block title %}
    {{ album.title }}
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            {# Main album title, centered and styled prominently #}
            <h1 class="display-4 text-primary text-center">{{ album.title }}</h1>

            {# Display artists and music groups involved, if any #}
            {% if album_artists or album_music_groups %}
                <p class="fs-5 text-center text-muted mb-4">
                    by
                    {# List artists with links separated by commas #}
                    {% for artist in album_artists %}
                        <a href="{% url 'contributor' artist.pk %}" class="hover-link fw-semibold">{{ artist }}</a>{% if not forloop.last or album_music_groups %}, {% endif %}
                    {% endfor %}
                    {# List music groups similarly #}
                    {% for group in album_music_groups %}
                        <a href="{% url 'music-group' group.pk %}" class="hover-link fw-semibold">{{ group }}</a>{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
            {% endif %}

            {# Outer wrapper for a subtle background and rounded corners with shadow #}
            <div class="bg-body-secondary rounded p-1 shadow-sm">
                {# Inner white container with padding and shadow for content separation #}
                <div class="bg-white rounded p-4 shadow-sm">
                    <div class="row">
                        {# Left column: Album cover and basic metadata #}
                        <div class="col-md-7 p-3">
                            {% if album.cover_image %}
                                <div class="text-start mb-3">
                                    {# Responsive album cover image with rounded corners and shadow #}
                                    <img src="{{ album.cover_image.url }}"
                                         alt="Cover image for album {{ album.title }}"
                                         class="img-fluid rounded shadow"
                                         style="max-width: 100%; max-height: 400px; object-fit: contain;">
                                </div>
                            {% endif %}

                            {# Genres displayed as badges with hover effect #}
                            <p><span class="header-custom">Genres: </span>
                                {% for genre in genres %}
                                    <span class="badge hover-badge me-1">{{ genre }}</span>
                                {% empty %} No genres {% endfor %}
                            </p>

                            {# Conditional display of release year, total duration and languages #}
                            {% if album.released %}
                                <p><span class="header-custom">Released year: </span> {{ album.released.year }}</p>
                            {% endif %}
                            {% if total_duration %}
                                <p><span class="header-custom">Total duration: </span> {{ total_duration }}</p>
                            {% endif %}
                            {% if languages %}
                                <p><span class="header-custom">Languages: </span>
                                    {% for l in languages %}{{ l.name }}{% if not forloop.last %}, {% endif %}{% endfor %}
                                </p>
                            {% endif %}
                        </div>

                        {# Right column: List of songs in the album, styled as a numbered list #}
                        <div class="col-md-5 p-3">
                            {% if songs %}
                            <ol class="list-group list-group-numbered">
                                <li class="text-center header-custom pb-2">Songs:</li>
                                {# Each song is a clickable list-group item with hover effect #}
                                {% for song in songs %}
                                    <a href="{% url 'song' song.pk %}" class="list-group-item list-group-item-action hover-item d-block px-3 py-2">
                                        {{ song.title }}
                                    </a>
                                {% empty %}
                                    {# Fallback message if no songs are present #}
                                    <div class="list-group-item text-muted">
                                        There is no song in the database.
                                    </div>
                                {% endfor %}
                            </ol>
                            {% endif %}
                        </div>
                    </div>

                    {# Accordion for contributors and music groups, if available #}
                    {% if contributors_by_category or groups_by_role %}
                        <div class="accordion mt-4" id="contributorsAccordion">
                            {# Loop through each contributor category (e.g. Performer, Writer) #}
                            {% for category, contributors in contributors_by_category.items %}
                                {% if contributors %}
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="heading-{{ forloop.counter }}">
                                            {# Accordion toggle button with collapsed default and bold font #}
                                            <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse"
                                                    data-bs-target="#collapse-{{ forloop.counter }}" aria-expanded="false"
                                                    aria-controls="collapse-{{ forloop.counter }}">
                                                {{ category|title }}s
                                            </button>
                                        </h2>
                                        <div id="collapse-{{ forloop.counter }}" class="accordion-collapse collapse"
                                             aria-labelledby="heading-{{ forloop.counter }}" data-bs-parent="#contributorsAccordion">
                                            {# Accordion body with no padding for cleaner look #}
                                            <div class="accordion-body p-1">
                                                <div class="list-group list-group-flush">
                                                    {# List each contributor with their roles shown on the right #}
                                                    {% for contributor, roles in contributors %}
                                                        <div class="list-group-item px-3 py-2 d-flex justify-content-between align-items-center">
                                                            <a href="{% url 'contributor' contributor.pk %}" class="hover-link">{{ contributor }}</a>
                                                            <small class="text-muted ms-2">({{ roles|join:", " }})</small>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}

                            {# Accordion item for music groups with roles #}
                            {% if groups_by_role %}
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading-groups">
                                        <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse"
                                                data-bs-target="#collapse-groups" aria-expanded="false"
                                                aria-controls="collapse-groups">
                                            Music Groups
                                        </button>
                                    </h2>
                                    <div id="collapse-groups" class="accordion-collapse collapse"
                                         aria-labelledby="heading-groups" data-bs-parent="#contributorsAccordion">
                                        <div class="accordion-body p-0">
                                            <div class="list-group list-group-flush">
                                                {# List all music groups with their roles in the album #}
                                                {% for role, groups in groups_by_role.items %}
                                                    {% for group in groups %}
                                                        <div class="list-group-item px-3 py-1 d-flex justify-content-between align-items-center">
                                                            <a href="{% url 'music-group' group.pk %}" class="hover-link">{{ group }}</a>
                                                            <small class="text-muted ms-2">({{ role }})</small>
                                                        </div>
                                                    {% endfor %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}

                    {# Album summary section if available #}
                    {% if album.summary %}
                        <div class="mt-4">
                            <p class="header-custom">Summary:</p>
                            <div class="text-body">{{ album.summary|linebreaks }}</div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
